<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visions Reference</title>
  <link rel="stylesheet" href="../assets/style.css">
  <style>
    .reference-container {
      max-width: 1200px;
    }

    .ghost-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .ghost-button {
      padding: 12px 24px;
      background-color: var(--primary-dark);
      border: 2px solid var(--accent-gold);
      color: var(--text-light);
      cursor: pointer;
      font-size: 0.95em;
      font-weight: bold;
      transition: all 0.3s ease;
      border-radius: 2px;
    }

    .ghost-button:hover,
    .ghost-button.active {
      background-color: var(--accent-gold);
      color: var(--primary-dark);
    }

    .access-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--accent-gold);
    }

    .access-tab {
      padding: 10px 20px;
      background-color: transparent;
      border: 2px solid transparent;
      border-bottom: none;
      color: var(--accent-gold);
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .access-tab:hover,
    .access-tab.active {
      background-color: rgba(212, 165, 116, 0.2);
      border: 2px solid var(--accent-gold);
      border-bottom: none;
    }

    .vision-container {
      background-color: var(--primary-dark);
      border: 2px solid var(--accent-gold);
      padding: 25px;
      margin: 20px 0;
    }

    .vision-item {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--accent-gold);
    }

    .vision-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .vision-number {
      display: inline-block;
      background-color: var(--accent-gold);
      color: var(--primary-dark);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      text-align: center;
      line-height: 32px;
      font-weight: bold;
      margin-right: 10px;
      font-size: 0.9em;
    }

    .vision-text {
      font-size: 0.95em;
      line-height: 1.6;
      color: var(--text-light);
      margin-top: 8px;
    }

    .ghost-info {
      background-color: rgba(212, 165, 116, 0.1);
      border-left: 4px solid var(--accent-gold);
      padding: 15px;
      margin-bottom: 25px;
    }

    .ghost-info h3 {
      color: var(--accent-gold);
      margin: 0 0 8px 0;
    }

    .ghost-info p {
      margin: 0;
      font-size: 0.9em;
      color: var(--text-light);
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container reference-container">
    <h1>Visions Reference</h1>
    <p style="font-style: italic; margin-bottom: 30px; color: var(--accent-gold);">All Visions - Full, Partial, and Mechanical Access Levels</p>

    <!-- Ghost Selector -->
    <div class="ghost-selector" id="ghostSelector">
      <!-- Buttons generated by JavaScript -->
    </div>

    <!-- Ghost Info -->
    <div class="ghost-info" id="ghostInfo">
      <!-- Info generated by JavaScript -->
    </div>

    <!-- Access Level Tabs -->
    <div class="access-tabs" id="accessTabs">
      <!-- Tabs generated by JavaScript -->
    </div>

    <!-- Visions Container -->
    <div class="vision-container" id="visionsContainer">
      <p style="text-align: center; color: var(--accent-gold);">Loading visions...</p>
    </div>
  </div>

  <script>
    let allVisions = {};
    let currentGhost = 'alice';
    let currentAccess = 'full';

    // Load visions from JSON
    async function loadVisions() {
      try {
        const response = await fetch('../data/visions.json');
        const data = await response.json();
        
        // Index visions by ghost
        data.visions.forEach(ghost => {
          allVisions[ghost.ghost] = ghost;
        });

        // Initialize UI
        setupGhostSelector();
        setupAccessTabs();
        displayVisions();
      } catch (error) {
        console.error('Error loading visions:', error);
        document.getElementById('visionsContainer').innerHTML = 
          '<p style="color: #ff6b6b; text-align: center;">Error loading visions. Check console.</p>';
      }
    }

    // Setup ghost selector buttons
    function setupGhostSelector() {
      const selector = document.getElementById('ghostSelector');
      selector.innerHTML = '';
      
      Object.keys(allVisions).forEach(ghost => {
        const ghostData = allVisions[ghost];
        const button = document.createElement('button');
        button.className = `ghost-button ${ghost === currentGhost ? 'active' : ''}`;
        button.textContent = ghostData.title;
        button.onclick = () => selectGhost(ghost);
        selector.appendChild(button);
      });
    }

    // Setup access level tabs
    function setupAccessTabs() {
      const tabs = document.getElementById('accessTabs');
      tabs.innerHTML = '';
      
      const accessLevels = ['full', 'partial', 'mechanical'];
      const labels = {
        'full': 'Full Access',
        'partial': 'Partial Access',
        'mechanical': 'Mechanical (Device)'
      };

      accessLevels.forEach(level => {
        const tab = document.createElement('button');
        tab.className = `access-tab ${level === currentAccess ? 'active' : ''}`;
        tab.textContent = labels[level];
        tab.onclick = () => selectAccess(level);
        tabs.appendChild(tab);
      });
    }

    // Select ghost
    function selectGhost(ghost) {
      currentGhost = ghost;
      currentAccess = 'full'; // Reset to full when changing ghosts
      setupGhostSelector();
      setupAccessTabs();
      displayVisions();
    }

    // Select access level
    function selectAccess(level) {
      currentAccess = level;
      setupAccessTabs();
      displayVisions();
    }

    // Display visions
    function displayVisions() {
      const ghostData = allVisions[currentGhost];
      const container = document.getElementById('visionsContainer');
      const infoDiv = document.getElementById('ghostInfo');

      // Update ghost info
      infoDiv.innerHTML = `
        <h3>${ghostData.title}</h3>
        <p>${ghostData.subtitle}</p>
      `;

      // Get visions for current access level
      const visions = ghostData[currentAccess];

      // Build visions HTML
      let html = '';
      visions.forEach((vision, index) => {
        html += `
          <div class="vision-item">
            <div>
              <span class="vision-number">${index + 1}</span>
              <strong>Vision ${index + 1}</strong>
            </div>
            <div class="vision-text">${escapeHtml(vision)}</div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Escape HTML special characters
    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, m => map[m]);
    }

    // Load visions when page loads
    document.addEventListener('DOMContentLoaded', loadVisions);
  </script>
</body>
</html>
